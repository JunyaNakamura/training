<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="jp.genuine.training.scheduler.datasource.sampledb.performance.PerformanceDetailMapper">

	<resultMap type="jp.genuine.training.scheduler.model.performance.Performance" id="performanceDetail">
		<id column="id" property="performanceId.value"/>
		<result column="name" property="performanceName.value"/>
		<result column="site_url" property="performanceUrl.value"/>
		<result column="place" property="venue.venueName.value"/>
		<result column="place_url" property="venue.venueUrl.value"/>
		<result column="start_date" property="performanceDate.performanceDateRange.start"/>
		<result column="end_date" property="performanceDate.performanceDateRange.end"/>
		<result column="memo" property="memo.value"/>
		<collection property="performanceDate.suspendDateList.list" ofType="java.time.LocalDate">
			<result column="holiday_date"/>
		</collection>
	</resultMap>

	<select id="findBy" resultMap="performanceDetail" flushCache="true">
		SELECT
			information.id,
			information.name,
			information.site_url,
			information.place,
			information.place_url,
			information.start_date,
			information.end_date,
			holiday.holiday_date,
			information.memo
		FROM
			performance.information
		LEFT OUTER JOIN
			performance.holiday
		ON
			information.id = holiday.performance_id
		WHERE
			information.user_id = #{user.userId.value}
		AND
			information.id = #{performanceId.value}
		ORDER BY
			holiday.holiday_date,holiday.id;
	</select>

</mapper>